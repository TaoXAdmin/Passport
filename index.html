<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Écoute du Micro en Temps Réel</title>
</head>
<body>
    <h1>Écoute du Micro en Temps Réel</h1>
    <p id="result-text">Le texte capturé sera affiché ici...</p>
    <p id="selected-country">Pays sélectionné : </p>

    <script>
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        let recognition;
        let isListening = false;

        // Correspondance entre les cartes et les pays
        const cardToCountry = {
            "as de pique": "Brazil",
            "2 de pique": "China",
            "3 de pique": "Israel",
            "4 de pique": "South Korea",
            "5 de pique": "Germany",
            "6 de pique": "Georgia",
            "7 de pique": "Russia",
            "8 de pique": "Italy",
            "9 de pique": "Canada",
            "10 de pique": "Poland",
            "valet de pique": "Thailand",
            "dame de pique": "Ukraine",
            "roi de pique": "Panama",
            "as de cœur": "Uruguay",
            "2 de cœur": "Argentina",
            "3 de cœur": "Mauritius",
            "4 de cœur": "Bahamas",
            "5 de cœur": "Cameroon",
            "6 de cœur": "Jamaica",
            "7 de cœur": "Spain",
            "8 de cœur": "France",
            "9 de cœur": "Greece",
            "10 de cœur": "Seychelles",
            "valet de cœur": "Ireland",
            "dame de cœur": "Colombia",
            "roi de cœur": "Portugal",
            "as de trèfle": "Switzerland",
            "2 de trèfle": "Marocco",
            "3 de trèfle": "Austria",
            "4 de trèfle": "Algeria",
            "5 de trèfle": "Norway",
            "6 de trèfle": "USA",
            "7 de trèfle": "Turkey",
            "8 de trèfle": "Philippines",
            "9 de trèfle": "Tanzania",
            "10 de trèfle": "Japan",
            "valet de trèfle": "Romania",
            "dame de trèfle": "Finland",
            "roi de trèfle": "Guyana",
            "as de carreau": "South Africa",
            "2 de carreau": "India",
            "3 de carreau": "Denmark",
            "4 de carreau": "Sweden",
            "5 de carreau": "Laos",
            "6 de carreau": "Belgium",
            "7 de carreau": "Australia",
            "8 de carreau": "Netherland",
            "9 de carreau": "Vietnam",
            "10 de carreau": "UK",
            "valet de carreau": "Peru",
            "dame de carreau": "Tunisia",
            "roi de carreau": "Macedonia"
        };

        function startRecognition() {
            if (!isListening) {
                recognition.start();
                isListening = true;
                console.log('Reconnaissance vocale commencée.');
            }
        }

        function stopRecognition() {
            if (isListening) {
                recognition.stop();
                isListening = false;
                console.log('Reconnaissance vocale arrêtée.');
            }
        }

        function analyzeTranscript(transcript) {
            // Parcourir toutes les cartes possibles pour trouver une correspondance
            for (let card in cardToCountry) {
                if (transcript.includes(card)) {
                    const country = cardToCountry[card];
                    document.getElementById('selected-country').textContent = `Pays sélectionné : ${country}`;

                    // Rediriger vers Google Images avec le pays sélectionné
                    const googleSearchUrl = `https://www.google.com/search?q=${encodeURIComponent(country)}&hl=fr&tbm=isch`;
                    window.location.href = googleSearchUrl;
                    break;
                }
            }
        }

        if (SpeechRecognition) {
            recognition = new SpeechRecognition();
            recognition.lang = 'fr-FR';
            recognition.continuous = true;
            recognition.interimResults = true;

            const resultText = document.getElementById('result-text');

            recognition.onresult = (event) => {
                let transcript = '';
                for (let i = 0; i < event.results.length; i++) {
                    transcript += event.results[i][0].transcript;
                }
                resultText.textContent = transcript;

                analyzeTranscript(transcript.toLowerCase());
            };

            recognition.onerror = (event) => {
                console.error('Erreur de reconnaissance vocale :', event.error);
                stopRecognition();
                startRecognition();
            };

            recognition.onend = () => {
                console.log('Reconnaissance vocale terminée.');
                isListening = false;
                startRecognition();
            };

            document.addEventListener('DOMContentLoaded', () => {
                startRecognition();
            });

            window.addEventListener('focus', () => {
                if (!isListening) {
                    startRecognition();
                }
            });

        } else {
            alert("Votre navigateur ne supporte pas la reconnaissance vocale.");
        }
    </script>
</body>
</html>
